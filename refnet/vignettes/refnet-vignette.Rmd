---
title: "RefNet"
author: "Emilio Bruna, Forest Stevens, Auriel Fournier, Matt Boone"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{RefNet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


RefNet is a package that helps import and analyze Web of Science references data. There's a linear process to go from importing the raw web of science data to plotting the results and performing network analysis.

## Import

This package can import Web of Science data, from multiple sources if necessary. The acceptable file formats are '.txt' and '.ciw'. For this step we will use the **read_references()** function which has three arguments:  

- **data**: The directory location of the web of science files. If left blank it assumes the files are in the working directory. If it's in a separate directory, the absolute file name or relative file paths can be used.  
- **dir**: This is a true false whether you're loading from a directory (multiple web of science files in one folder, or a single file)
- **filename_root**: This specifies the output and the prefix of the output reference file. If you do not want to write a file leave this field blank. To save to a location with a prefix write the folder path followed by a '/' and then the prefix. For example:  

`"./newpath/newprefix".`  

Will save the file under the root directory + "/newpath/newprefix_references.csv"


An example of loading from a directory:  

`read_references(data = './data', dir = T, filename_root = './output/WOS')`

And loading from a single file:

`read_references(data = './data/Brazil.txt', dir = F, filename_root = './output/Brazil')`

The output of this file is a cleaned and combined file with all relevant fields merged. This is used as a base file for later analysis:

<img src="C:/Users/birde/Dropbox/refnet/Reference.PNG" height="300" />

## Parsing authors and matching up the same authors
The next step in the process is to use the newly made reference sheet to identify authors names and identify what authors are the same person. This can be difficult because different journals publish names in different formats. Sometimes with First names, sometimes only initials, sometimes with middle names, sometimes with no middle initial. It is because of this the function attempts to match names that are similar. However, these matches need to be hand checked for accuracy.

For this we'll use the **read_authors()** function. It takes the reference sheet we created and outputs a file of matched authors, and a master list. It has two arguments:  

- **references**: This is an object created from read_references. You can load in a previous reference sheet as long as it's an output from read_references and is saved to an object  
- **filename_root**: This is used to specify the location and prefix of the two objects. It works the exact same way as read_references. 


##Hand checking matches
Now that the algorithm has attempted to match similar names the user needs to hand check the matches. Open up the 'authors' output from the previous function. There are two important pieces of information in these files:  

- **AuthorID/GroupID**: There are two ID fields, AuthorID and GroupID. AuthorID is the unique identifier for each entry. GroupID is the ID that identifies what records are the same person.  

- **Match name**: This is the matching name the algorithm identified as part of the same author group.   

- **Similarity**: This is the similarity score calculated on likely matches. This is calculated using jaro-winkler similarity analysis. This is not performed on exact name matches or matches that did not have similar last name, first, middle combinations. This is a score from 1-100. 100 being an exact match.  

The algorithm attempts to match similar authors and then assigns similar authors to the same groupID. It then saves all match names into a file appended with '_authors.csv'. This file is the one you want to hand check matches, because it does it this iteratively the **groupID will always be the smallest authorID** of the group.

<img src="C:/Users/birde/Dropbox/refnet/AuthorMatch.PNG" height="300" />

The sheet is ordered by groupID and then authorID. Go through each match and check that the matches make sense. You can use the similarity score, physical address, and email address to help assess whether names are the same or not. If in doubt, prior knowledge or Google should be helpful. If you find authors that are **NOT** the same person but assigned the same groupID, simply change each records **groupID** to its **authorID** to make them independent groups. 

Conversely, if you find authors that should be grouped (difficult to find), then you change each records **GroupID** to the same **GroupID** so that all records match. In this case it is good practice to make the groupID the smallest authorID of the cohort. 

When you're done, save this .csv file, load it back into R and we'll merge the change records in the next step.

##Recombine authors
After making final assignments of similar authors, we want to merge the changes together for use in the final analysis. For this we'll use the **refine_authors()** function. It has four arguments:  
 
- **authors**: This is the new fixed authors object we saved previously. Must be in an object  
- **master**: This should be the unedited master file that was created from read_authors(). Must be in an object   
- **sim_score**: If you would like to set a threshold for the similarity score, where all scores below a threshold are assigned novel groupIDs, set the cut off here. By default this is turned off.  
- **filename_root**: The location and prefix of the output, works the same as the other functions.  

##Calculating authors location
Now that we've identified matching authors we will calculate the authors location including their latitudes and longitudes for later mapping. We will use the **address_lat_long()** function. It has 2 arguments:  

- data: This is the output created from refine_authors. Must be an object.  
- address_column: This is a quoted character identifying what the column name that the addresses are stored in.  

The output is a modified data.frame with new columns for the latitude and longitude as well as various pieces of the address the algorithm could correctly parse out.  


**warning** This function parses out addresses from the web of science reference sheet and then attempts to calculate the latitude and longitude using the datascience toolkit or Google maps API. This means it needs to use the internet and may take a rather long time to process depending on the amount of addresses it has to calculate. **warning**  

##Plotting
Now that we've successfully imported, wrangled, and checked the data. We can begin plotting the data. There five kinds of plots you can make. They are in two categories **World plots** and **Net Plots**. World plots simply plot author locations on a world map. Net plots use network analysis to plot connections of co-authorship on papers. We'll go from simple to complex. It's important to note that the rendering of these plots may take time, particularly if the amount of individual authors is >1000, depending on your computers processing power. So give it time if you are using an older computer or attempting to map a large number of points

###World Plots (by country)
To make a colored plot of all authors country of residency we'll use the **plot_addresses_country()**. The function has one argument:  

- **data**: This is the output from addresses_lat_long. Must be an object.

<img src="C:/Users/birde/Dropbox/refnet/WorldCountry.png" height="400" />

###World Plots (points)
To individual plot points of each authors location we'll use the **plot_addresses_points()**. The function has one argument:  

- **data**: This is the output from addresses_lat_long. Must be an object.

<img src="C:/Users/birde/Dropbox/refnet/WorldPoint.png" height="400" />

###Net Plots (base)
To plot a network diagram of co-author countries of origins and how they're connected we'll use the **net_plot_coauthor()** function. The function has one argument:  

- **data**: This is the output from addresses_lat_long. Must be an object.

This function has two outputs, in the form of a list. $plot is the plot, $data is the dataframe that was used to the build the plot. listname$plot is not very customizable, which is why $data is provided, so the user can build their own plot to their specific needs. 

<img src="C:/Users/birde/Dropbox/refnet/NetPlotBase.png" height="400" />  


###Net Plots (Country)
To plot a network diagram of co-author countries of origins overlayed on a world map we'll use **net_plot_coauthor_country()** function. The function has one argument:  

- **data**: This is the output from addresses_lat_long. Must be an object.  

The net plot analysis returns an object that allows the plotting of these complex connections. $plot will plot the output to your plotting console. $data is the dataframe that was used to the build the plot. $plot is not very customizable, which is why $data is provided, so the user can build their own plot to their specific needs. 

<img src="C:/Users/birde/Dropbox/refnet/NetPlotCountry.png" height="400" />  


###Net Plots (Addresses)
To plot a network diagram of co-author using their individual addresses overlayed on a world map we'll use **net_plot_coauthor_addresses()** function. The function has one argument:  

- **data**: This is the output from addresses_lat_long. Must be an object.

The net plot analysis returns an object that allows the plotting of these complex connections. $plot will plot the output to your plotting console.  $data is the dataframe that was used to the build the plot. $plot is not very customizable, which is why $data is provided, so the user can build their own plot to their specific needs. 

This function can create a large data set (100's of MB), and may takes several minutes, so be patient and take the size of resources into account when running.  


<img src="C:/Users/birde/Dropbox/refnet/NetPlotAddress.png" height="400" />  



