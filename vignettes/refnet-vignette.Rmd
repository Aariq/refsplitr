---
title: "refnet"
author: "Auriel Fournier, Forest Stevens, Matt Boone, Emilio M. Bruna"
date: "`r Sys.Date()`"
fig_caption: yes
output:
  pdf_document:
    highlight: tango
  html_document:
    standalone: true
    highlight: tango
    self-contained: true
vignette: >
  %\VignetteIndexEntry{Multi-format vignettes}
  \usepackage[utf8]{inputenc}
  %\VignetteEngine{knitr::multiformat}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

##1. Introduction

The Science of Science (SciSci) is an emerging, transdisciplinary approach for using large and disparate datasets to study the emergence, disemination, and impact of scientific research (Fortunato et al. 2018). Bibliometric databases such as the [Web of Science](https://login.webofknowledge.com/error/Error?PathInfo=%2F&Error=IPError) and [SCOPUS](https://www.scopus.com/home.uri) are rich sources of data for SciSci studies (Sugimoto and Lariviare 2018). In recent years the type and scope of questions addressed with data gathered from these databases has expanded tremendously (Forutnato et al. 2018). This is due in part to their expanding coverage and greater accessibility, but also because advances in computational power make it possible to analyze datasets comprising millions of bibliographic records (e.g., Lariviare et al. 2013, Smith et al. 2014). 

The rapidly increasing size of bibliometric datasets available to researchers has exascerbated two major and persistent challenges in SciSci research. The first of these is **Author Name Disambiguation**. Correctly identifying the authors of a research product is fundamental to bibliometric research, as is the ability to correctly attribute to a given author all of their scholarly output. However, this seemingly straightforward task can often be extremely complicated, even when using the nominally high-quality data extracted from bibliometric databases (reviewed in Smalheiser and Torvik 2009). The most obvious case is when different authors have identical names, which can be quite common in some countries (Strotmann et al. 2009). However, confusion might also arise as a result of journal conventions or individual preferences for abbreviating names. For instance, one might conclude "J. C. Smith", "Jennifer C. Smith", and "J. Smith" are different authors, when in fact they are the same person. In contrast, papers by "E. Martinez" could have been written by different authors with the same last name but whose first names start with the same letter (e.g., "Enrique", "Eduardo"). Failure to disambiguate author names can seriously undermine the conclusions of some SciSci studies, but manually verifying author identity quickly becomes impractical as the number of authors or papers in a dataset increases. 

The second challenge to working with large bibliometric datasets is correctly **parsing author addresses**. The structure of author affiliations is complex and idiosyncratic, and journals differ in the information they require authors to provide and the way in which they present it. Authors may also represent affiliations in different ways on different articles. For instance, the affiliations might be written in different ways in different journals (e.g., "Dept. of Biology", "Department of Biology", "Departamento de Biologia"). The same is true of the institution's name ("UC Davis", "University of California-Davis","University of California") or the country in which it is based ("USA", "United States", "United States of America"). Researchers at academic institutions might include the one or more Centers, Institutes, Colleges, Departments, or Programs in their address, and researchers working for the same institution could be based at units in geographically disparate locations (e.g., a [University of Florida researcher could be based at one of 12 statewide Research and Education Centers, five research laboratories, 67 county extension offices, or the main campus in Gainesville](https://research.ifas.ufl.edu/main-menu-tab/about-us/research-facilities/)). Finally, affiliations are recorded in a single field of a reference's bibliographic record, despite comprising very different types of information (e.g., city, postal code, institution). In concert, these factors can make it challenging to conduct analyses for which author affiliation or location is of particular interest.     

Package [**`refnet`**](https://CRAN.R-project.org/package=XXXXX) helps users of the R statistical computing environment (R Core Team 2017) address these challenges. It imports and organizes the output from Web of Science and SCOPUS searches, disambiguates author names and suggests which might need additional scrutiny, parses author addresses, and georeferences authors' institutions (Fig 1). It also generates simple summary bibliometric statistics and maps author locations and coauthorships. Finally, the processed datasets can be exported in tidy formats for more in-depth analyses with user-written code or imported into packages such as [**`revtools`**](https://cran.r-project.org/web/packages/revtools/index.html) (Westgate 2018) or [**`bibliometrix`**](https://cran.r-project.org/web/packages/bibliometrix/index.html) (Aria & Cuccurullo 2017).


##2. Using refnet

Appendix 1 provides guidance on downloading records from the Web of Science in the proper format for use in `refnet`.  Once bibliographic records have been downloaded, `refnet`'s tools are applied in four steps:   

1. importing and tidying reference records (Section 2.1)
2. author name disambiguation and parsing of author addresses (Section 2.2)
3. georeferencing of author institutions (Section 2.3)
4. data analysis and visualization (Section 2.4)

These steps are described in greater detail below; Appendix 2 guides users through the entire process with a sample dataset. *The instructions below assume one has created two folders in ones working directory or Rstudio Project Folder: one named 'data' and one names 'output' - and that the exported bibliographic records are saved in the 'data' folder*.    

![With `refnet` users can import, organize, and visualize bibliographic data in four simple steps.](refnet_fig1.jpg) 

<!-- <p align="center"> -->
<!-- !<img src="refnet_fig1.jpg" height="300"/> -->
<!-- </p> -->
<!-- <p align="center"> -->
<!-- **Figure 1:** With `refnet` users can import, organize, and visualize bibliographic data in four simple steps. -->
<!-- </p> -->

###2.1. Importing Search Results 

The `refnet` package can either import a single Web of Science/SCOPUS search result file or combine and import multiple files located in the same directory. The acceptable file formats are '.txt' and '.ciw'. Importing reference records is done with the `references_read()` function, which has three arguments:  

- **data**: The location of the directory in which the Web of Science file(s) are located. If left blank it assumes the files are in the working directory. If in a different directory (e.g., the 'data' folder in the working directory), the absolute file name or relative file paths can be used.  

- **dir**: TRUE when loading multiple files; FALSE when loading a single file. When multiple files are processed `refnet` identifies and removes any duplicate reference records.

- **filename_root**: The location in which the output file is to be saved (e.g., the 'output' folder in the working directory) and the prefix used to name it. If you do not want to write a file leave this field blank. 

The output of `references_read()` is an object in the R Workspace and a .csv file. Each line is a WOS record, columns are the different fields of the bibliographic record (e.g., AU: author name, SO: article source, TI: article title; a complete list is in Appendix 2). This file is used by `refnet` for Step 2.

<!-- <img src="Reference.PNG" height="300" />  -->

####Example

a. To import and process a single file located in a folder named "data" and save the output as a file named "Brazil" it in a folder named "output": 

> `Brazil_references <- references_read(data = './data/Brazil.txt', dir = F, filename_root = './output/Brazil')`


b. To import and process multiple files located in a folder named "data" and save the output as "WOS" in a folder named "output": 

> `WOS_references <- references_read(data = './data', dir = T, filename_root = './output/WOS')`

c. To save to a location with a prefix, write the folder path followed by a '/' and then the prefix. This will save the file under the root directory as "/newpath/newprefix_references.csv": 

> `"./newpath/newprefix".`


###2.2. Author address parsing and name disambiguation 

The next step is to identify all unique authors in the dataset and parse their affiliations for each of their articles. This requires identifying any authors whose name appears to be represented in different ways on different publications. Name disambiguation is a complex statistical and computational problem for which researchers have used data ranging from author affiliation to patterns of coauthorship and citation (reviewed in Smalheiser & Torvik 2009). The `authors_clean()` disambiguation algorithm, described in greater detail in Appendix 3, first assigns each author of each article a unique ID number, then assigns putative name variants representing the same author a group ID number. The function `authors_clean()` has two arguments:  

- **references**: The object created by `references_read()`, from which author names will be extracted. Any previously generated output from `references_read()` that has been saved to an object can be used.

- **filename_root**:  The location in which the output file is to be saved and the prefix used to name it. If you do not want to write a file leave this field blank. The syntax is the same as for `references_read()`. 

The output of `authors_clean()` is a list in the R workspace with two elements: (1) "prelim", which is the initial list of disambiguated author names, and (2) "review", which is the subset of authors with putative name variants suggested for verification. Each of these elements is also saved as a separate .csv file in the location specified in the function (e.g., the output folder in the working directory).  

Once disambiguation is complete, users can accept the results without manually reviewing names flagged for additional inspection (Section 2.2.1). Alternatively, users can review the subset of names recommended for inspection and make any necessary corrections (Section 2.2.2). These corrections are then used to generate a refined dataset for analyses (Section 2.2.3). 

####Example

a. To disambiguate the authors of all references in the dataset and place the "preliminary" and "review" author lists in the "output" folder: 

> `Brazil_authors <- authors_clean(Brazil_references, filename_root="./output/Brazil")`

####2.2.1. Accepting the results of author disambiguation *without* manual review

If the users wish to accept the result of the disambiguation algorithm without manually reviewing names, they can do the results can be accepted with the `authors_refine()` function. It has four arguments:  
 
- **review**: The names proposed for manual review. Must be in an object.  
- **prelim**: The preliminary file of disambiguated author names created with `authors_clean()`. Must be in an object   
- **sim_score**: The threshold for the similarity score below which authors are assigned different groupIDs.  By default this is turned off. Users can set sim_score values to make name group assignment based on name similarity more or less stringent (range: 0-1, with 1 = names identical). **[EB note: too much info? clear? correct?]**
- **filename_root**: The prefix for the resulting output and locations to which it will be saved, using the same syntax as for previous functions. 

The output of `authors_refine()` is **--------------------** .   

####Example

a. To accept the results of author disambigiuation without manual review: 

> `Brazil_authors_refined <- authors_refine(Brazil_review, Brazil_authors_prelim, filename_root="./output/Brazil")`

####2.2.2. Reviewing and correcting the results of disambiguation

Users that prefer to manually review the results of the disambiguation can do so with the "authors" object and .csv files. An overvire of the information provided in these files and how to use it to review and correct author name assignments is provided in Appendix 2).

> **If different authors were incorrectly assigned the same groupID number:** replace the number in the **groupID** column of the unique author with the value from that person's **authorID** column. *Be sure to use the authorID value from the same row.* 

> **If the same author was incorrectly assigned different groupID numbers:** replace the number in the **groupID** column of the name variants to be pooled with a single **AuthorID** number. *We recommend using the lowest authorID number of the name variants being pooled*.

Once the revision is complete, save the file as a .csv file in the same location as the original file with the name "----authors_corrected.csv" **[NOTE: we should explain to save with a different name to avoid writing over the original groupings. otherwise they would need to redisambiguate if they later discovered they made any mistakes (also to keep all original files)**. 

####2.2.3. Uploading and merging the results of disambiguation

Corrections made to the "Author" file are merged into the "Master List" file using the `authors_refine()` function. It has four arguments:  
 
- **corrected**: The corrected version of the "review" object. Must be in an object.  
- **prelim**: The preliminary list of disambiguated author names created with `authors_clean()`. Must be in an object   
- **sim_score**: The threshold for the similarity score below which authors are assigned different groupIDs. By default this is turned off.  
- **filename_root**: The prefix for the resulting output and locations to which it will be saved, using the same syntax as for previous functions. 

The output of `authors_refine()` is a file. This file can be used for many analyses, including.

####Example

> `Brazil_authors_refined <- authors_refine(Brazil_authors_corrected, Brazil_authors_prelim, filename_root="./output/Brazil")`

###2.3. Georeferencing author institutions 

Users can georeference (latitude & longitude) author's institutions using the `authors_georef()` function. This function has has 2 arguments:  

- **data**: The output created by `authors_refine()`. Must be an object.
- **address_column**: A quoted character identifying the column name in which addresses are stored.
- **write_out_missing**: if TRUE creates a file with the author addresses that that `refnet` was unable to georeference; set to FALSE by default

The outputs of `authors_georef()` are (1) a modified data.frame with new columns for the latitude and longitude of each authors institution and the parts of the author's address that could be parsed out from the WOS record, and (2) an output/file of references that refnet was unable to georeference, which the user can review, manually correct, and import back into the file of georeferenced author locations **[HOW? DETAILS NEEDED]**. 

> **Warning**: this version of refnet (1.0) has trouble differentiating between campuses with similar names (e.g. University of Florida Main Campus, vs University of Florida Sattellite Campus [better (actual) example]), which can be problemaic for some analyses


```
addresses <- authors_georef(data)

new_address <- read.csv("missing_addresses.csv", 
                          stringsAsFactors = FALSE)

masteraddresses <- rbind(addresses$not_missing_addresses,
                          new_address)
```

> **warning** This function parses out addresses from the Web of Science reference sheet and then attempts to calculate the latitude and longitude using the datascience toolkit or Google maps API. This means it needs to use the internet and may take a rather long time to process depending on the amount of addresses it has to calculate. **warning**  


####Example

> `Brazil_georef <-authors_georef(------,------,-----)`

###2.4. Bibliometric analyses and Data Visualization

refnet includes some basic summary analyses and data visualization tools....  

####2.4.1 Bibliometric analyses *EB: I HAVE CODE TO DO ALL OF THIS BUT:  IT IS ALL IN TIDYVERSE. SHOULD WE INCLUDE AS AN APPENDINX OR HERE?*
1. OVERALL
+ total number of articles
+ total number of authors
+ Average number of authors per article (+/-SD or SE)
+ Histogram of authors per article
+ total number of countries

2. BY YEAR
+ total number of articles
+ total number of authors
+ cumulative number of authors
+ average number of authors per article (+/-SD or SE)
+ number of countries per year
+ cumulative number of countries

####2.4.2 Visualizing Productivity and Collaboration 
`refnet` can generate five visualizations of productivity and collaboration. These are either **World plots** or **Net plots**. World plots simply plot author locations on a world map. Net plots use network analysis to plot connections of co-authorship on papers. We'll go from simple to complex. It's important to note that the rendering of these plots may take time, particularly if the amount of individual authors is >1000, depending on your computers processing power. So give it time if you are using an older computer or attempting to map a large number of points

####2.4.2.1. World Plots (by country)
To make a colored plot of all authors country of residency we'll use the `plot_addresses_country()`. The function has one argument:  

- **data**: This is the output from addresses_lat_long. Must be an object.

The output of `plot_addresses_country()` is a .....[need to add to be consistent with prior steps]

####Example


<p align="center">
<img src="WorldCountry.png" height="300" /> 
</p>

####2.4.2.2. World Plots (points)
To individual plot points of each authors location we'll use the `plot_addresses_points()`. The function has one argument:  

- **data**: This is the output from `authors_georef()`. Must be an object.

The output of `authors_georef()` is a .....[need to add to be consistent with prior steps]

####Example


<p align="center">
<img src="WorldPoint.png" height="300" /> 
</p>

####2.4.2.3. Net Plots (base)
To plot a network diagram of co-author countries of origins and how they're connected we'll use the `net_plot_coauthor()` function. The function has one argument:  

- **data**: This is the output from `authors_georef()`. Must be an object.

This function has two outputs, in the form of a list. `$plot` is the plot, `$data` is the dataframe that was used to the build the plot. `listname$plot` is not very customizable, which is why `$data` is provided, so the user can build their own plot to their specific needs. 

The output of `net_plot_coauthor()` is a .....[need to add to be consistent with prior steps]

####Example


<p align="center">
<img src="NetPlotBase.png" height="300" /> 
</p>

####2.4.2.4. Net Plots (Country)
To plot a network diagram of co-author countries of origins overlayed on a world map we'll use **`net_plot_coauthor_country()`** function. The function has one argument:  

- **data**: This is the output from `authors_georef()`. Must be an object.  

The output of`net_plot_coauthor_country()` is an object that allows the plotting of these complex connections. `$plot` will plot the output to your plotting console. `$data` is the dataframe that was used to the build the plot. `$plot` is not very customizable, which is why `$data` is provided, so the user can build their own plot to their specific needs. 

####Example

<p align="center">
<img src="NetPlotCountry.png" height="300" /> 
</p>


####2.4.2.5. Net Plots (Addresses)
To plot a network diagram of co-author using their individual addresses overlayed on a world map we'll use `net_plot_coauthor_addresses()` function. The function has one argument:  

- **data**: This is the output from `authors_georef()`. Must be an object.

The output of `net_plot_coauthor_addresses()` is an object that allows the plotting of these complex connections. `$plot` will plot the output to your plotting console.  `$data` is the dataframe that was used to the build the plot. `$plot` is not very customizable, which is why $data is provided, so the user can build their own plot to their specific needs. 

This function can create a large data set (100's of MB), and may takes several minutes, so be patient and take the size of resources into account when running.  


####Example

<p align="center">
<img src="NetPlotAddress.png" height="300" /> 
</p>


##Summary

The refnet package greatly simplifies the process of organizing, correcting, and visualizing data from the Web of Science and other bibliometric databases.  



##Acknowledgments

Support for the development of refnet was provided by grants from the University of Florida Center for Latin American Studies and the University of Florida Informatics Institute.

##References

Aria, M. & Cuccurullo, C. (2017) bibliometrix: An R-tool for comprehensive science mapping analysis. Journal of Informetrics, 11(4): 959-975.

Fortunato, S., C. T. Bergstrom, K. Barner, J. A. Evans, D. Helbing, S. Milojevic, A. M. Petersen, F. Radicchi, R. Sinatra, B. Uzzi, A. Vespignani, L. Waltman, D. Wang, & A.-L. Barabasi (2018). Science of science. Science, 359: eaao0185.

Lariviare, V., Ni, C., Gingras, Y., Cronin, B., & Sugimoto, C. R. (2013). Bibliometrics: Global gender disparities in science. Nature News, 504(7479): 211-213

R Core Team (2017). R: A Language and Environment for Statistical Computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

Smalheiser, N. R., & Torvik, V. I. (2009). Author name disambiguation. Annual Review of Information Science and Technology, 43(1): 1-43.

Smith, M. J., Weinberger, C., Bruna, E. M., & Allesina, S. (2014). The scientific impact of nations: Journal placement and citation performance, PLOS One 9(10): e109195.

Strotmann, A. and Zhao, D., (2012). Author name disambiguation: What difference does it make in author based citation analysis?. Journal of the Association for Information Science and Technology, 63(9): 1820-1833.

Sugimoto CR, Lariviare V. (2018). Measuring Research: What Everyone Needs to Know®. Oxford University Press, Oxford, UK. 149 pp.

Westgate, M. J. (2018b). revtools: bibliographic data visualization for evidence synthesis in R. bioRxiv:262881. doi: 10.1101/262881


***

**Appendix 1:** Guide to downloading reference records from the Web of Science&copy;.

<p align="center">
<img src="WOSsearch_fig.tiff" width="1200" / > 
</p>

***


**Appendix 2:** Ste-by-step guide to processing, reviewing, and visualizing data with `refnet`. 


IMPORTING REFERENCE RECORDS




Are these all in the list below? We need to define filename and refID, whihc are added by our functions.
"filename" "AB"       "AF"       "AU"       "BP"      
"C1"       "CC"       "CH"       "CL"       "CR"      
"CT"       "CY"       "DE"       "DI"       "DT"      
"EM"       "EP"       "FN"       "FU"       "FX"      
"GA"       "GE"       "ID"       "IS"       "J9"      
"JI"       "LA"       "LT"       "MC"       "MI"      
"NR"       "PA"       "PD"       "PG"       "PI"      
"PN"       "PS"       "PT"       "PU"       "PY"      
"RI"       "RID"      "OI"       "PM"       "RP"      
"SC"       "SI"       "SN"       "SO"       "SU"      
"TA"       "TC"       "TI"       "UT"       "VR"      
"VL"       "WC"       "Z9"       "refID"   



[Web of Science Core Collection Field Tags](https://images.webofknowledge.com/images/help/WOS/hs_wos_fieldtags.html)" two-character tags that identify fields in records selected for export.

FN File Name
VR Version Number
PT Publication Type (J=Journal; B=Book; S=Series; P=Patent)
AU Authors
AF Author Full Name
BA Book Authors
BF Book Authors Full Name
CA Group Authors
GP Book Group Authors
BE Editors
TI Document Title
SO Publication Name
SE Book Series Title
BS Book Series Subtitle
LA Language
DT Document Type
CT Conference Title
CY Conference Date
CL Conference Location
SP Conference Sponsors
HO Conference Host
DE Author Keywords
ID Keywords Plus®
AB Abstract
C1 Author Address
RP Reprint Address
EM E-mail Address
RI ResearcherID Number
OI ORCID Identifier (Open Researcher and Contributor ID)
FU Funding Agency and Grant Number
FX Funding Text
CR Cited References
NR Cited Reference Count
TC Web of Science Core Collection Times Cited Count
Z9 Total Times Cited Count (Web of Science Core Collection, BIOSIS Citation Index, Chinese Science Citation Database, Data Citation Index, Russian Science Citation Index, SciELO Citation Index)
U1 Usage Count (Last 180 Days)
U2 Usage Count (Since 2013)
PU Publisher
PI Publisher City
PA Publisher Address
SN International Standard Serial Number (ISSN)
EI Electronic International Standard Serial Number (eISSN)
BN International Standard Book Number (ISBN)
J9 29-Character Source Abbreviation
JI ISO Source Abbreviation
PD Publication Date
PY Year Published
VL Volume
IS Issue
SI Special Issue
PN Part Number
SU Supplement
MA Meeting Abstract
BP Beginning Page
EP Ending Page
AR Article Number
DI Digital Object Identifier (DOI)
D2 Book Digital Object Identifier (DOI)
EA Early access date
EY Early access year
PG Page Count
P2 Chapter Count (Book Citation Index)
WC Web of Science Categories
SC Research Areas
GA Document Delivery Number
PM PubMed ID
UT Accession Number
OA Open Access Indicator
HP ESI Hot Paper. Note that this field is valued only for ESI subscribers.
HC ESI Highly Cited Paper. Note that this field is valued only for ESI subscribers.
DA Date this report was generated.


################
PROCESSING REFERNCE RECORDS



##################
REVIEWING AND CORRECTING NAMES


- **authorID**: AuthorID is a unique identifier for each name in the database (i.e., every author of every paper; the initial assumption of refnet's disambiguation algorithm is that all authors of all articles are different individuals).    

- **AU**:	Authors

- **AF**:	Author Full Name

- **groupID**: This indicates which names (i.e., AuthorID numbers) have been grouped together under a single groupID number because they are believed to be the same person. Because disambiguation is performed iteratively. *The lowest authorID number in a group will always be used as the groupID*.

- **match_name**: The name under which the algorithm groups all of an author's putative name variants.   

- **similarity**: The Jaro-Winkler similarity score when comparing ---- and --- (range = 1-100, with a score of 100 indicating an exact match). We do not perform this analysis on name that are identical or matches without similar last name, first name, middle combinations. [this needs a better explanation]

- **author_order** the location on the article's list of authors where the specific author is found 

- **address**: the author's address in the WOS record for an article.

- **university**: the author's institution, if present from the address

- **department**: the author's department, if present, from the address

- **short_address**: the author's street address 

- **postal_code**: the author's postal code

- **country**: the author's country 

- **RP_address**: the reprint address, if present

- **RI**: the author's Thomson-Reuters Researcher ID number in the WOS record for an article(if they have one).

- **OI**:	the author's ORCID ID number in the WOS record for an article  (if they have one).

- **EM**:the author's email address in the WOS record for an article (if it lists one).

- **UT**: Accession Number

- **refID**: An id number given to each reference (HOW IS IT DEFINED? ORDER READ INTO file by READ_AUTHORS????)

- **PT**: Publication Type (J=Journal; B=Book; S=Series; P=Patent)

- **PY**: Publication Year

- **PU**: Publisher

<p align="center">  
<img src="AuthorMatch.PNG" height="300" /> 
</p>
  
Users can assess if the validity of grouping different author name variants under a single groupID using the similarity score, author address, ORCID AND Researcher ID numbers, and author email address. They can also use the original record for the authors and articles to search for them online. 


##############
VISUALIZING RESULTS




**Appendix 3:** Overview of the `refnet` algorithm for author name disambiguation.

